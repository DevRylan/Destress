<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <title>Profile Page</title>
    <meta name="author" content="Chidera Chuka"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="profilepage.css">

    <script>
    document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("editForm");
    if (form) {
        form.addEventListener("submit", e => e.preventDefault());
    }
});
</script>
</head>

<body>
    <!-- Header -->
    <header>
        <div id="button_nav">
            <button id="menuButton">
                <img src="images/menu icon.png" alt="menu button"> 
                
            </button>

        <nav id="navBar" class="hidden">
            <ul>
                <li><a href="homepage.html">Homepage</a></li>
                <li><a href="tools.html">Tools</a></li>
                <li><a href="login.html">Login</a></li>
            </ul>
        </nav>
        </div>


        <!-- Logo -->
        <div id="logoWrapper">
            <img id="headerLogo" src="LogoDestress.png" alt="logo">
        </div>

    </header>

    <!-- Main page -->
    <main id="profile_layout">

        <!-- Left profile -->
        <section class="profile_card">
            <h2 class="profile-header">
                Your Profile
                <img src="images/pen.png" class="edit-icon" alt="profile-edit">
            </h2>


            <div class="profile_img">
                <img src="images/profileicon.jpeg" alt="profileicon">
            </div>

            <p class="profile-name"><strong>Frank C. Colins</strong></p>
            <p class="profile-age"><strong>Age:</strong> 38</p>
            <p class="profile-gender"><strong>Gender:</strong> M</p>
            <p class="profile-stress_levels"><strong>Average Stress Levels:</strong> 5/10</p>
        </section>

        <!-- Right stress chart -->
        <section class="chart_section">
            <h2>Recent Stress Levels</h2>

            <div class="chart-container">
                <canvas id="stressChart" height="300"></canvas>
            </div>
        </section>

        <!-- Below settings -->
        <section class="settings_section">
            <h2>Settings</h2>

            <div class="setting_item">
                <span>Mode</span>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting_item">
                <span>Notifications</span>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting_item">
                <span>Report a problem</span>
                </label>
            </div>

            <div class="setting_item">
                <span>Terms and Conditions</span>
                </label>
            </div>

            <div class="setting_item">
                <span>Logout</span>
                </label>
            </div>

            
            <div class="setting_item">
                <span>DELETE ACCOUNT</span>
                </label>
            </div>
        </section>

        <!-- Profile edit popup -->
        <div id="editModal" class="modal hidden">
            <div class="modal-content">
                <h2>Edit Profile</h2>

                <form id="editForm">

                    <label>Name:</label>
                    <input type="text" id="editName" name="name">

                    <label>Age:</label>
                    <input type="number" id="editAge" name="age" min="1">

                    <label>Gender:</label>
                    <select id="editGender" name="gender">
                        <option value="M">M</option>
                        <option value="F">F</option>
                    </select>

                    <label>Average Stress Level (1â€“10):</label>
                    <input type="number" id="editStress" name="stress_level" min="1" max="10">

                    <button type="submit">Save</button>
                    <button type="button" id="closeModal">Cancel</button>
                </form>
            </div>
        </div>


    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="profilepage.js" defer></script>

<script>
document.getElementById("editForm").addEventListener("submit", async function (e) {
    e.preventDefault(); // stop page redirects

    const formData = new FormData(this);

    const res = await fetch("update_profile.php", {
        method: "POST",
        body: formData
    });

    const json = await res.json();

    if (json.success) {
        // Close modal
        document.getElementById("editModal").classList.add("hidden");

        // Update fields in the profile card
        document.querySelector(".profile-name").innerHTML = "<strong>" + formData.get("name") + "</strong>";
        document.querySelector(".profile-age").innerHTML = "<strong>Age:</strong> " + formData.get("age");
        document.querySelector(".profile-gender").innerHTML = "<strong>Gender:</strong> " + formData.get("gender");
        document.querySelector(".profile-stress_levels").innerHTML =
            "<strong>Average Stress Levels:</strong> " + formData.get("stress_level") + "/10";
    } else {
        alert("Error: " + json.error);
    }
});

// open modal
document.querySelector(".edit-icon").onclick = () => {
    document.getElementById("editModal").classList.remove("hidden");
};

// close modal
document.getElementById("closeModal").onclick = () => {
    document.getElementById("editModal").classList.add("hidden");
};
</script>


</body>
</html>
